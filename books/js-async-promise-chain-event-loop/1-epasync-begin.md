---
title: "はじめに"
---

# 学習ロードマップ
次の記事で「非同期処理を理解できるようになるまでので学習ロードマップ」について書きました。「学習のロードマップは分かったけど、具体的な非同期処理のポイントも知りたい」といった要望について応えるためにこの本を書きました。

https://zenn.dev/estra/articles/js-async-programming-roadmap

# この本について
この本では、**非同期処理の真髄**と言っても過言ではない Promise チェーンと Event loop から非同期処理の重要であるポイント(自分が重要と感じたポイント)を解説してみたいと思います。

ただし、この本では Promise そのものについての基本はあまり説明しません。今回は例外処理なども気にせずにただ Promise チェーンを構築して Event loop でどうなるかを予測し、JS Visualizer 9000 で実際に可視化していきます。

この本の目的としては読者が「**非同期処理の制御の流れを理解し、予測できるようになる**」ことを掲げています。

:::message
今回あえて Book(本) として公開している理由は、かなり長い内容になるので記事一本では書ききれないと感じたためです。追加の内容や修正などを頻繁に行う必要があるので、本を作るのも初めてなので今回は実験も兼ねて Book(本) で公開しています。

この本では可能な限り正確な情報になるように努力していますが、学習者のアウトプットとしての側面が強いので、間違い等があるかもしれません。その点についてはご容赦ください。なにか不備や間違いを見つけた場合にはスクラップにて教えていただける非常に助かります。
:::

# 前準備
この本の内容を理解するために、JSConf EU での Philip Roberts 氏の講演動画である『What the heck is the event loop anyway?』をはじめに見ることを強く推奨しています。

@[youtube](8aGhZQkoFbQ)

この動画で、"イベントループ"と"コールスタック"、非同期 API の概要を掴んでからこの本の内容を読んでいただけると良いと思います。

# 注意点
この記事では実際のコードを通して、Promise チェーンがどのような制御で実行されるかを確認していきます。この本を読む際にはぜひ自分で実行してみるようにしてください。

JavaScript と一言で言っても様々な環境で使用される言語ですから、どういった環境で使用するかを考える必要があります。

- Chrome などのブラウザ環境
- Node や Deno といったランタイム環境

自分は Deno がお気に入りなので、この本の説明で使用する JavaScript の実行は基本的に Deno ランタイム環境で行っています。

```sh
❯ deno -V
deno 1.20.4
```

Promise を使った非同期処理を**あらゆる環境において包括的に考える**という目的もありますが、Deno ではデフォルトで TypeScript を設定無しにすぐに実行できるので、**最終的に TypeScript で Promise の型を考える**ために使っているという理由もあります。

後のチャプターで詳しく解説しますが、Chrome などのブラウザ環境や Node, Deno といったランタイム環境において**イベントループの本質的な部分は共通しています**。とはいえ環境による違いもあるので、それについても解説しておきました。

環境に拘らずに考えるために途中で V8 エンジンを使用します。V8 エンジンのバージョンは次のものとなります。

```sh
❯ v8
V8 version 10.3.154
```

# 参考文献について
各チャプターのいたるところで参考となる文献やリソースの URL を貼っておきます。

学習リソースなどに困ったら、「非同期処理を理解できるようになるまでので学習ロードマップ」の記事に挙げたリソースなどを参考にしてもらえばいいかと思います。

# スクラップについて
この本に関する感想や質問等あれば、紐付けられたスクラップの方へどうぞ。

https://zenn.dev/estra/scraps/20dc6c4a1b64f8

間違いや誤植等を見つけた場合には教えていただけるとありがたいです。

# 表記について
Event loop で Promise チェーンがどのように動くか JavaScript Visualizer 9000 というツールをこの本の各所で使用していきます。名前が長いので、以降「JS Visualizer」と呼称します。

また、関数の引数に渡すコールバック関数について `then(cb)` や `then(callback)` のように `cb` や `callback` と省略表記する場合があるので注意してください。

ECMAScript や HTML Living standard, Node.js などで同じものを表す場合に用語が違ったりするのでまとめておきます。また途中ででてくる単語に表記ゆれがあった場合もこちらを参照してください。

| 元々のワード | 別の表記 |
|--|--|
| Message loop | Event loop, イベントループ |
| Task | Macrotask, マクロタスク、タスク |
| Task queue | Macrotask queue, マクロタスクキュー, タスクキュー |
| Job | ジョブ, Microtask, マイクロタスク |
| Job queue | ジョブキュー, Microtask queue, マイクロタスクキュー |

混乱を避けるために次の言葉を意図的に使用するようにします。また、英単語を記載する際には大文字から始めるようにします。

- Event loop (またはイベントループ)
- Task (またはタスク)
- Microtask (またはマイクロタスク) 

:::message
最初は Task(タスク) よりも Macrotask(マクロタスク) の単語の方が理解しやすいかと思っていたのですが、Task(タスク) 方が本質を捉えやすい言葉だと感じたのでこちらをなるべく使っていきたいと思います。

加えて Macro と Micro は似ているので見間違いやすいという理由もあります。
:::
# ChangeLog
大きな変更のみトラッキングしています。

:::details ChangeLog
- 2022-05-14
  - 新チャプター追加
    - ch「catch メソッドと finally メソッド」を追加
    - ch「Promise チェーンから非同期関数へ」を追加
    - ch「V8 エンジンによる async/await の内部変換」を追加
- 2022-05-06
  - 新チャプターを追加
    - ch「コールスタックと実行コンテキスト」を追加
    - ch「それぞれのイベントループ」を追加
    - ch「タスクキューとマイクロタスクキュー」を追加
    - ch「V8 エンジン」を追加
    - ch「非同期 API と環境」を追加
    - ch「resolve と reject の使い方」を追加
  - ch「古い非同期 API を Promise でラップする」を改修
  - ch「イベントループは内部にネストしたループがある」を改修
- 2022-05-03
  - ch「then メソッドのコールバックで非同期処理」に「副作用とは」の項目を追加
  - 新しいチャプター「Promise の基本概念」を追加
- 2022-04-23
  - Ch「then メソッドのコールバックで非同期処理」を大幅追記
- 2022-04-21
  - JavaScript Visuzalizer で共有したコードが文字化けしていたので修正
  - Ch「Event loop の概要と注意点」を大幅に修正追記
    - それに伴い Event loop のステップについて各所を修正
  - Ch「Promise コンストラクタと Executor 関数」で関数式とアロー関数の補足を追加
  - Ch「コールバック関数の同期実行と非同期実行」で「コールバック関数はいつ実行される?」の項目を追加
  - Ch「then メソッドは常に新しい Promise を返す」で「Promise の状態を確かめる」の項目を追加
  - Ch「Promise チェーンで値を繋ぐ」で「チェーンの最後まで値を繋ぐ」の項目を追加
  - Ch「Promise チェーンはネストさせない」で「fetch の例[作成中]」の項目を追加
  - Ch「Event loop は内部にネストしたループがある」を追加
  - その他全体的に加筆修正
  - コードの表記を修正
:::