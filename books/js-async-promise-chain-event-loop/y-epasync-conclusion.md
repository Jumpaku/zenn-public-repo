---
title: "総括 - 非同期処理のまとめ"
---

# このチャプターについて

大変お疲れ様でした。「非同期処理」のテーマの話はこれにて終了となりま s。

ここまで「非同期処理」にまつわる様々な事柄について学んできましたが、最終チャプターとして主な話題についての総括と振り返りを行っておきたい思います。

# 概念は組み合わせて理解する

「非同期処理、同期処理、非同期 API、並列、並行、逐次」この辺りの言葉や概念は非常に紛らわしいですが、「非同期処理の全体の仕組み」を理解する上では**全部使います**。全部使うというのは、言葉のまま、全部のタイプの処理が組み合わされることで大きくくくられる「非同期処理」の仕組みが実現されるということです。

# イベントループによる並行処理
イベントループによって並行に処理を切り替えることのできるおかげで並行(concurrent)処理ができていますが、この並行処理は結果的に、ソースコードの配置順番に実行されないため、タイミングがずれることになります。結果的に「非同期」に実行される訳です。つまり、非同期処理は並行処理に、並行処理は非同期処理になるという訳です。卵が先か鶏が先かみたいになりますが、非同期処理はタイミングがずれて実行されるので、結局は並行になります。

イベントループにおけるミソは、タスクやマイクロタスクの連鎖的な処理です。非同期処理では制御によってどのように逐次処理を実現していくかが重要になりますが、タスクやマイクロタスクを連鎖的に発行することで時間的に非連続になる可能性のある逐次処理を実現していきます。

# 非同期 API による並列的作業
実際には「非同期」という概念は「**複数の関連する事象が前の事象の完了を待たずに起きる**」ことを意味し、非同期 API そのものの性質を指し示していました。非同期 API は Non-blocking API とも呼ばれメインスレッドをブロッキングすることなく並列的に時間のかかる処理を環境がバックグラウンドで代行してくれました。

「非同期処理」の目的はこの時間のかかる処理を環境にバックグラウンドでおこなわせている間もメインスレッドで別の作業ができるようにすることでした。本質的には「時間の良い」非同期 API を利用したいからわざわざ「非同期処理」という制御の難しいことをやるわけです。ブラウザ環境ならメインスレッドは UI スレッドであり、レンダリング処理もこのメインスレッドで行われている訳ですから、長時間かかるような API 処理でスレッドをブロッキングしてしまうとユーザーがなにもできない時間ができるので更にシビアな問題になります。

# すべては効率の良い非同期 API を使いたいがため
結局のところ、Promise や async/await といった非同期にまつわる ECMAScript のシンタックスは「効率の良い」非同期 API の絡む処理がしたいから書かざる負えないものであり、制御が難しいので非同期 API を使わない場合にはわざわざ書く必要がありません。

「非同期処理」というテーマの目的は「効率の良い非同期 API」を使う際にに発生する後続の関連する処理がコード配置と実行順序がずれてしまう処理をいかに記述するかにあります。そして、非同期 API の処理を起点とした一連の処理手順(逐次処理)の順序を保証することが非同期処理では重要です。

# 非同期 API の後続処理を制御するためのシンタックス

非同期 API を使う際にはこれらのシンタックスを利用します。厳密には非同期 API の処理を行ったあとにその API 処理から取得したデータなどを使った関連する後続処理を制御するために非同期のシンタックスを書くことになります。

そのシンタックスこそが Promise や async/await です。

実際には、async/await は Promise のシステムに基づき Promsie を扱う Promise 処理の利便性を向上させるものでした。特に async 関数では Promise を扱っていることを意識する必要があります。つまり、asycn/await が主役なのではなく、あくまで Promise が主役というわけです。

非同期 API を起点とした一連の処理の手順を正しく保証するためには、適切な Promise chain の構築や await 式の配置を行っていく必要があります。適切にそれらのことを行うことで、意図した処理の順序付けや並列化により効率化して処理を制御できます。並列化する際には、実際には非同期 API 処理を並列化していることに注意してください。

# TypeScript は型を上乗せするだけ

TypeScirpt は JavaScript に型システムを導入した言語ですが、本質的にはより良い JavaScript を書くためのツール(リンター)に過ぎません。非同期処理を理解するためには JavaScript の実行環境や非同期 API、ECMAScript のシンタックスへの理解が欠かせません。

TypeScript によって上乗せされる型情報は本質的には非同期処理と関係がないですが、扱うデータの具象性を上げて堅牢なコードを書くために学ぶ必要があります。

# まとめ

以上が「非同期処理」というテーマの話となりました。かなり長く壮大なテーマでしたが、裏側の原理や本質的な部分を押さえることで非同期処理の実行順序の制御のみならず、JavaScript や環境への理解を深めることができたと思います。

また、ECMAScript や JavaScsript、TypeScript などの境界線を意識することもできた思います。これによって、今後わからないことがあればどの領域の話なのか追求できるようになったと思います。

自分自身、非同期処理というテーマを通して様々なことを学ぶことができたと思っていますが、読んでくださった方も同様にこのテーマを通して多くのものを学ぶことができたと感じていただければ大変嬉しく思います。

ここまでお疲れ様でした。また、長い文章を読んで頂き誠にありがとう御座いました。最後のページはあとがきとなります。

